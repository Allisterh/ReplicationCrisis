## Overview
This repository contains code that create a dataset of global stock returns and characteristics. The dataset was created for the paper [Is There a Replication Crisis in Finance?](https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3774514) by Jensen, Kelly and Pedersen (2021). Please cite this paper if you are using the code or data.

Documentation.pdf provides detailed descriptions of the code and all data construction choices. chars.xlsx lists the 153 factors (and their original sources, directional bets, and significance in the original paper) studied in Jensen, Kelly and Pedersen (2021), which is a subset of the factors/characteristics generated by this code.

## How to Run the Code
The .sas files construct the stock-level characteristics and factor portfolio returns for all countries. The code requires a connection to WRDS servers. Below we outline our preferred approach to creating the dataset:

1. Connect to the [SAS studio server hosted by WRDS](https://wrds-cloud.wharton.upenn.edu/SASStudio/index?locale=en_US).  
2. Create a folder called _Global Data_ in your home directory and upload `main.sas`, `project_macros.sas`, `market_chars.sas`, `accounting_chars.sas`, `char_macros.sas`, `portfolios.sas`, `ind_identification.sas` and `chars.xlsx` to this folder.
3. Create an empty folder in your institutions scratch folder. The scratch folder is located at "Sever Files and Folders/Files/scratch/\<institution name\>".
4. Open `main.sas` 
5. Replace line 8 with the path to the scratch folder created in step 3. 
6. Run `main.sas`.  

For step 6, we suggest that you make a background submit. To do so, locate the `main.sas` file in your _Global Data_ folder, right-clik the file and select "Background Submit". Running the code will take around 24 hours. When the code has finished running, your scratch folder will contain a folder called _output_. This folder contains daily and monthly market returns, market equity breakpoints from NYSE and return breakpoints from CRSP. Furthermore, the scratch folder will contain the main dataset called _world_data.sas7bdat_. If you wish to have the data in .csv format, run the  `%save_main_data_csv()` macro on line 220. The macro will create a zip folder with a separate .csv file for each country and save it in the output folder. Importantly, the datasets only include the main observation of common stocks that are primary securities, with non-missing market equity data. 

Note that the space in the scratch directory is shared across users in your institution. It's best practice to delete files after downloading what you need. Furthermore, files in the scratch directory is deleted after 7 days.
